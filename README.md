# CNNCascade_194FeaturePts
## Introduction
This project refer to [Extensive Facial Landmark Localization with Coarse-to-fine Convolutional Network Cascade](http://www.faceplusplus.com/wp-content/uploads/FacialLandmarkpaper.pdf). 

This project present a new approach to localize extensive facial landmarks with a coarse-to-fine convolutional network cascade. This paper design a four-level convolutional network cascade, which tackles the problem in a coarse-to-fine manner. In this system, each network level is trained to locally refine a subset of facial landmarks generated by previous network levels. 

In addition, each level predicts explicit geometric constraints (the position and rotation angles of a specific facial component) to rectify the inputs of the current network level. The combination of coarse-to-fine cascade and geometric refinement enables our system to locate extensive facial landmarks (194 points) accurately in the [300-W facial landmark localization challenge](http://ibug.doc.ic.ac.uk/resources/300-W/).
 ![system overview](https://github.com/CongWeilin/CNNCascade_194FeaturePts/blob/master/system%20overview.png)

## Dependences
* [Caffe](http://caffe.berkeleyvision.org)
* [python 2.7](https://www.python.org)
* [opencv 2.4.13](http://opencv.org)

## Tools
1.[`calibrate_pts.py`](https://github.com/CongWeilin/CNNCascade_194FeaturePts/blob/master/tools/calibrate_pts.py): This is a tools to calibrate [Helen_dataset](http://www.ifp.illinois.edu/%7Evuongle2/helen/) or your new image. The user instruction is printed on the top of the calibrate window.

## Process
Step 1: Bounding Box Estimation.

According to the image bellow, it is quite convenient to calculate Innor Points Bounding Box and Contour Bounding Box if eyes', nose' and mouth corners' position are known. So I trained a shallow network to calculate the general position of them. You can check them on [DCNN-caffe](https://github.com/CongWeilin/DCNN-caffe) and you can find the [model](https://github.com/CongWeilin/DCNN-caffe/blob/master/train_img/preprocessed_img/F1/model/_iter_1000000.caffemodel).  
![face radio](https://github.com/CongWeilin/CNNCascade_194FeaturePts/blob/master/introduction/Bounding%20Box.jpeg)

Innor Points Bounding Box : <br>
x = LE.x - (RE.x - LE.x) / 2 <br>
y = N.y - [N.y - Max(RE.y, LE.y)] × 2 <br>
w = (RE.x - LE.x)×2 <br>
h = [N.y - Min(RE.y, LE.y)] × 3.5 <br>
Counter Points Bounding Box : <br>
x = LE.x - (RE.x - LE.x) <br>
y = Max(RE.y, LE.y) - [Max(LM.y,RM.y) - N.y] <br>
w = (RE.x - LE.x) × 3 <br>
h = [Max(LM.y,RM.y) - Min(RE.y, LE.y)] * 2 <br>
